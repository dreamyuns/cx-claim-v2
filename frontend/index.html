<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CX í´ë ˆì„ì²˜ë¦¬ ì‹œìŠ¤í…œ V2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #2c3e50;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ìƒíƒœ íŒ¨ë„ */
        .status-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }

        .status-waiting { background-color: #6c757d; }
        .status-running { 
            background-color: #ffc107; 
            animation: pulse 1.5s infinite;
        }
        .status-completed { background-color: #28a745; }
        .status-failed { background-color: #dc3545; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .status-text {
            font-size: 1.2em;
            font-weight: bold;
        }

        /* ì„¤ì • íƒ­ */
        .config-tabs {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            position: sticky;
            top: 120px;
            z-index: 99;
        }

        .tab-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            position: relative;
        }

        .tab-save-header {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tab-save-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #495057;
        }

        .btn-save-tab {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save-tab:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-1px);
        }

        .btn-save-tab:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .tab-button {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .tab-button:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .tab-button.active {
            background: white;
            border-color: #667eea;
            color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* íƒ­ ì½˜í…ì¸  */
        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        /* ì„¤ì • í¼ */
        .config-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .config-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.25);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        /* ì‹¤í–‰ íŒ¨ë„ */
        .execution-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .execution-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° */
        .data-preview {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .preview-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* ë©”ì¼ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° */
        .email-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .email-preview h5 {
            color: #495057;
            margin-bottom: 10px;
        }

        .email-subject {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
            margin-bottom: 15px;
        }

        .email-body {
            background: white;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 400px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            position: absolute;
            z-index: 1000;
            top: -10px;
            left: 110%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            font-size: 14px;
            line-height: 1.4;
        }

        .tooltip .tooltiptext h6 {
            margin: 0 0 8px 0;
            color: #495057;
            font-size: 14px;
        }

        .tooltip .tooltiptext ul {
            margin: 5px 0;
            padding-left: 20px;
        }

        .tooltip .tooltiptext li {
            margin: 3px 0;
            font-size: 13px;
        }

        .tooltip .tooltiptext code {
            background-color: #e9ecef;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .form-row {
                flex-direction: column;
                gap: 10px;
            }

            .execution-buttons {
                flex-direction: column;
                align-items: center;
            }

            .preview-stats {
                grid-template-columns: 1fr;
            }

            .tab-header {
                flex-direction: column;
                gap: 10px;
            }

            .tooltip .tooltiptext {
                width: 300px;
                left: 50%;
                transform: translateX(-50%);
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <h1>ğŸ¨ CX í´ë ˆì„ì²˜ë¦¬ ì‹œìŠ¤í…œ V2.0</h1>
        <p>ê³ ê° í´ë ˆì„ ìë™ ì²˜ë¦¬ ë° ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
    </div>

    <div class="container">
        <!-- ìƒíƒœ íŒ¨ë„ -->
        <div class="status-panel">
            <div id="statusIndicator" class="status-indicator status-waiting"></div>
            <span id="statusText" class="status-text">ëŒ€ê¸° ì¤‘</span>
            <div id="progressContainer" style="display: none;">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div id="progressText">0%</div>
            </div>
        </div>

        <!-- ì„¤ì • íƒ­ -->
        <div class="config-tabs">
            <div class="tab-header">
                <button class="tab-button active" onclick="showTab('basic')">ğŸ“‹ ê¸°ë³¸ ì„¤ì •</button>
                <button class="tab-button" onclick="showTab('email')">ğŸ“§ ë©”ì¼ í…œí”Œë¦¿</button>
                <button class="tab-button" onclick="showTab('test')">ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ</button>
                <button class="tab-button" onclick="showTab('execution')">ğŸš€ í”„ë¡œì íŠ¸ ì‹¤í–‰</button>
            </div>

            <!-- ê¸°ë³¸ ì„¤ì • íƒ­ -->
            <div id="basicTab" class="tab-content active">
                <div class="tab-save-header">
                    <div class="tab-save-title">ê¸°ë³¸ ì„¤ì •</div>
                    <button class="btn-save-tab" onclick="saveConfig()">ì„¤ì • ì €ì¥</button>
                </div>

                <div class="config-section">
                    <h4>ğŸ” ë¡œê·¸ì¸ ì •ë³´</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="loginUrl">ê´€ë¦¬ì URL</label>
                            <input type="text" id="loginUrl" placeholder="https://adm.allmytour.com">
                        </div>
                        <div class="form-group">
                            <label for="userId">ì‚¬ìš©ì ID</label>
                            <input type="text" id="userId" placeholder="ì‚¬ìš©ì ID">
                        </div>
                        <div class="form-group">
                            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h4>ğŸ“ íŒŒì¼ ê²½ë¡œ</h4>
                    <div class="alert alert-info" style="margin-bottom: 15px; padding: 15px; background-color: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 8px; color: #004085;">
                        <strong>ğŸ’¡ ê²½ë¡œ ì…ë ¥ ì•ˆë‚´:</strong><br>
                        â€¢ <strong>ë¡œì»¬ í…ŒìŠ¤íŠ¸:</strong> Windows ê²½ë¡œ ì…ë ¥ ê°€ëŠ¥ (ì˜ˆ: C:\Users\...)<br>
                        â€¢ <strong>ì„œë²„ ë°°í¬:</strong> Linux ê²½ë¡œ ì…ë ¥ (ì˜ˆ: /home/user/projects/data/íŒŒì¼ëª….xlsx)<br>
                        â€¢ <strong>ìë™ ë³€í™˜:</strong> Windows ê²½ë¡œ ì…ë ¥ ì‹œ ì„œë²„ ê²½ë¡œë¡œ ìë™ ë³€í™˜ë©ë‹ˆë‹¤.
                    </div>
                    <div class="form-group">
                        <label for="cxExcel">CX Excel íŒŒì¼ ê²½ë¡œ</label>
                        <input type="text" id="cxExcel" placeholder="cx_list.xlsx ì—‘ì…€íŒŒì¼ ê²½ë¡œ ì…ë ¥ (Windows ë˜ëŠ” Linux ê²½ë¡œ)">
                    </div>
                    <div class="form-group">
                        <label for="claimListDir">í´ë ˆì„ ë¦¬ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬</label>
                        <input type="text" id="claimListDir" placeholder="claim_list í´ë”ê²½ë¡œ ì…ë ¥">
                    </div>
                    <div class="form-group">
                        <label for="resultsDir">ê²°ê³¼ ë””ë ‰í† ë¦¬</label>
                        <input type="text" id="resultsDir" placeholder="results í´ë” ê²½ë¡œ ì…ë ¥">
                    </div>
                    <div class="form-group">
                        <label for="logsDir">ë¡œê·¸ ë””ë ‰í† ë¦¬</label>
                        <input type="text" id="logsDir" placeholder="logs í´ë” ê²½ë¡œ ì…ë ¥">
                    </div>
                </div>

                <div class="config-section">
                    <h4>âš™ï¸ ì‹¤í–‰ ì„¤ì •</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pageLoadDelay">í˜ì´ì§€ ë¡œë“œ ëŒ€ê¸°ì‹œê°„ (ì´ˆ)</label>
                            <input type="number" id="pageLoadDelay" placeholder="3" min="1" max="10">
                        </div>
                        <div class="form-group">
                            <label for="elementWaitTime">ìš”ì†Œ ëŒ€ê¸°ì‹œê°„ (ì´ˆ)</label>
                            <input type="number" id="elementWaitTime" placeholder="10" min="5" max="30">
                        </div>
                    </div>
                </div>

                <!-- ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° ì„¹ì…˜ ì¶”ê°€ -->
                <div class="config-section">
                    <h4>ğŸ“Š ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h4>
                    <button class="btn btn-primary" onclick="loadDataPreview()">ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
                    <div id="dataPreview" class="data-preview" style="margin-top: 20px;">
                        <div class="preview-header">
                            <h5>ğŸ“Š Excel ë°ì´í„° í˜„í™©</h5>
                        </div>
                        <div id="previewStats" class="preview-stats">
                            <!-- í†µê³„ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                        <div id="previewTable">
                            <!-- ë°ì´í„° í…Œì´ë¸”ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë©”ì¼ í…œí”Œë¦¿ íƒ­ -->
            <div id="emailTab" class="tab-content">
                <div class="tab-save-header">
                    <div class="tab-save-title">ë©”ì¼ í…œí”Œë¦¿ ê´€ë¦¬</div>
                    <div>
                        <button class="btn btn-secondary" onclick="resetEmailTemplates()" style="margin-right: 10px;">ì´ˆê¸°í™”</button>
                        <button class="btn-save-tab" onclick="saveEmailTemplates()">í…œí”Œë¦¿ ì €ì¥</button>
                    </div>
                </div>

                <div class="config-section">
                    <h4>ğŸ“§ ë©”ì¼ ì œëª© í…œí”Œë¦¿</h4>
                    <div class="form-group">
                        <label for="subjectTemplate">ì œëª© í…œí”Œë¦¿</label>
                        <input type="text" id="subjectTemplate" placeholder="[í´ë ˆì„ì²˜ë¦¬] {ìˆ™ì†Œ} - {ìš”ì²­ë¶„ë¥˜}">
                    </div>
                </div>

                <div class="config-section">
                    <h4>ğŸ“ ë©”ì¼ ë³¸ë¬¸ í…œí”Œë¦¿</h4>
                    <div class="form-group">
                        <label for="bodyTemplate">ë³¸ë¬¸ í…œí”Œë¦¿</label>
                        <textarea id="bodyTemplate" placeholder="ì•ˆë…•í•˜ì„¸ìš”, {íˆ¬ìˆ™ì}ë‹˜&#10;&#10;ìš”ì²­í•˜ì‹  í´ë ˆì„ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.&#10;&#10;â–  ì˜ˆì•½ ì •ë³´&#10;- ìˆ™ì†Œ: {ìˆ™ì†Œ}&#10;- ì²´í¬ì¸: {ì²´í¬ì¸}&#10;- ì²´í¬ì•„ì›ƒ: {ì²´í¬ì•„ì›ƒ}&#10;- íˆ¬ìˆ™ì: {íˆ¬ìˆ™ì}&#10;&#10;â–  ìš”ì²­ ë‚´ìš©&#10;- ë¶„ë¥˜: {ìš”ì²­ë¶„ë¥˜}&#10;- ì‚¬ìœ : {ìš”ì²­ì‚¬ìœ }&#10;- ìƒì„¸: {ìš”ì²­ì‚¬í•­}&#10;&#10;ì²˜ë¦¬ ê²°ê³¼ëŠ” ë³„ë„ë¡œ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.&#10;&#10;ê°ì‚¬í•©ë‹ˆë‹¤."></textarea>
                    </div>
                </div>

                <div class="config-section">
                    <h4>ğŸ‘ï¸ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°</h4>
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-primary" onclick="previewEmailTemplate()">ë¯¸ë¦¬ë³´ê¸° ìƒì„±</button>
                        <div class="tooltip" style="display: inline-block; margin-left: 10px;">
                            <button class="btn btn-info" type="button">ì‚¬ìš© ê°€ëŠ¥í•œ ë°ì´í„° ?</button>
                            <div class="tooltiptext">
                                <h6>ğŸ“Š Excelì—ì„œ ê°€ì ¸ì˜¤ëŠ” ë°ì´í„°:</h6>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li><code>{Book NO}</code> - ì£¼ë¬¸ë²ˆí˜¸</li>
                                    <li><code>{íˆ¬ìˆ™ì}</code> - ê³ ê°ëª…</li>
                                    <li><code>{íˆ¬ìˆ™ìëª…}</code> - ê³ ê°ëª… (íˆ¬ìˆ™ìì™€ ë™ì¼)</li>
                                    <li><code>{ìš”ì²­ë¶„ë¥˜}</code> - ìš”ì²­ë¶„ë¥˜</li>
                                    <li><code>{ìš”ì²­ì‚¬ìœ }</code> - ìš”ì²­ì‚¬ìœ </li>
                                    <li><code>{ìš”ì²­ì‚¬í•­}</code> - ìš”ì²­ì‚¬í•­</li>
                                    <li><code>{ìš”ì²­ë‚ ì§œ}</code> - ìš”ì²­ë‚ ì§œ</li>
                                    <li><code>{ë‹´ë‹¹ì}</code> - ë‹´ë‹¹ì</li>
                                </ul>
                                
                                <h6>ğŸ”§ ê¸°ë³¸ê°’ìœ¼ë¡œ ì œê³µë˜ëŠ” ë°ì´í„°:</h6>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li><code>{ì²´í¬ì¸}</code> - ì²´í¬ì¸ ë‚ ì§œ (ì˜ˆ: 2024-01-15)</li>
                                    <li><code>{ì²´í¬ì•„ì›ƒ}</code> - ì²´í¬ì•„ì›ƒ ë‚ ì§œ (ì˜ˆ: 2024-01-17)</li>
                                    <li><code>{ìˆ™ì†Œ}</code> - ìˆ™ì†Œëª… (ì˜ˆ: ê·¸ëœë“œ í˜¸í…” ì„œìš¸)</li>
                                    <li><code>{íˆ¬ìˆ™ì ì—°ë½ì²˜}</code> - ì—°ë½ì²˜ (ì˜ˆ: 010-1234-5678)</li>
                                    <li><code>{ë°•ìˆ˜}</code> - ë°•ìˆ˜ (ì˜ˆ: 2ë°•)</li>
                                    <li><code>{ê°ì‹¤ìˆ˜}</code> - ê°ì‹¤ìˆ˜ (ì˜ˆ: 1)</li>
                                    <li><code>{ê°ì‹¤ëª…}</code> - ê°ì‹¤ëª… (ì˜ˆ: ë””ëŸ­ìŠ¤ ë£¸)</li>
                                    <li><code>{ìƒí’ˆëª…}</code> - ìƒí’ˆëª… (ì˜ˆ: ì„œìš¸ 2ë°• 3ì¼ íŒ¨í‚¤ì§€)</li>
                                </ul>
                                
                                <p style="margin: 10px 0 0 0; font-size: 12px; color: #6c757d;">
                                    ğŸ’¡ í…œí”Œë¦¿ì—ì„œ <code>{ë³€ìˆ˜ëª…}</code> í˜•íƒœë¡œ ì‚¬ìš©í•˜ì„¸ìš”
                                </p>
                            </div>
                        </div>
                    </div>
                    <div id="emailPreview" class="email-preview" style="display: none;">
                        <h5>ğŸ“§ ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°</h5>
                        <div id="emailError" class="email-error" style="color: red; display: none; margin-bottom: 15px; padding: 10px; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px;"></div>
                        <div id="emailSubject" class="email-subject"></div>
                        <div id="emailBody" class="email-body"></div>
                    </div>
                </div>
            </div>

            <!-- í…ŒìŠ¤íŠ¸ ëª¨ë“œ íƒ­ -->
            <div id="testTab" class="tab-content">
                <div class="tab-save-header">
                    <div class="tab-save-title">í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì„¤ì •</div>
                    <button class="btn-save-tab" onclick="saveTestConfig()">í…ŒìŠ¤íŠ¸ ì„¤ì • ì €ì¥</button>
                </div>

                <div class="config-section">
                    <h4>ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë²”ìœ„</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="testStartRow">ì‹œì‘ í–‰</label>
                            <input type="number" id="testStartRow" placeholder="2" min="1">
                        </div>
                        <div class="form-group">
                            <label for="testEndRow">ì¢…ë£Œ í–‰</label>
                            <input type="number" id="testEndRow" placeholder="5" min="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="testModeEnabled">í…ŒìŠ¤íŠ¸ ëª¨ë“œ í™œì„±í™”</label>
                        <select id="testModeEnabled">
                            <option value="false">ì„¤ì • ì•ˆí•¨</option>
                            <option value="true">ì„¤ì •</option>
                        </select>
                    </div>
                </div>

            </div>

            <!-- í”„ë¡œì íŠ¸ ì‹¤í–‰ íƒ­ -->
            <div id="executionTab" class="tab-content">
                <div class="tab-save-header">
                    <div class="tab-save-title">í”„ë¡œì íŠ¸ ì‹¤í–‰</div>
                </div>

                <div class="config-section">
                    <h4>ğŸš€ í”„ë¡œì íŠ¸ ì‹¤í–‰</h4>
                    <div class="execution-buttons">
                        <button id="startBtn" class="btn btn-success" onclick="startProject()">í”„ë¡œì íŠ¸ ì‹œì‘</button>
                        <button id="stopBtn" class="btn btn-danger" onclick="stopProject()" disabled>í”„ë¡œì íŠ¸ ì¤‘ë‹¨</button>
                        <button class="btn btn-primary" onclick="loadStatus()">ìƒíƒœ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                    <div id="executionLog" style="margin-top: 20px; text-align: left; background: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 200px; overflow-y: auto;">
                        <!-- ì‹¤í–‰ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentConfig = {};
        let statusInterval = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            loadStatus();
            startStatusPolling();
        });

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        // ì„¤ì • ë¡œë“œ
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                const result = await response.json();
                
                if (result.success) {
                    currentConfig = result.config;
                    populateConfigForm();
                } else {
                    showError('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                showError('ì„¤ì • ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì„¤ì • í¼ì— ë°ì´í„° ì±„ìš°ê¸°
        function populateConfigForm() {
            // 1. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ ì‹œë„
            const savedData = localStorage.getItem('cx_claim_form_data');
            if (savedData) {
                try {
                    const formData = JSON.parse(savedData);
                    populateFormWithSavedData(formData);
                    return; // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ì‚¬ìš©
                } catch (e) {
                    console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', e);
                }
            }
            
            // 2. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ê°€ ì—†ìœ¼ë©´ ì„œë²„ ë°ì´í„° ì‚¬ìš©
            populateFormWithServerData();
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„°ë¡œ í¼ ì±„ìš°ê¸°
        function populateFormWithSavedData(formData) {
            // ë¡œê·¸ì¸ ì •ë³´
            document.getElementById('loginUrl').value = formData.login?.url || '';
            document.getElementById('userId').value = formData.login?.user_id || '';
            document.getElementById('password').value = formData.login?.password || '';

            // íŒŒì¼ ê²½ë¡œ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë³µì›)
            document.getElementById('cxExcel').value = formData.file_paths?.cx_excel || '';
            document.getElementById('claimListDir').value = formData.file_paths?.claim_list_dir || '';
            document.getElementById('resultsDir').value = formData.file_paths?.results_dir || '';
            document.getElementById('logsDir').value = formData.file_paths?.logs_dir || '';

            // ì‹¤í–‰ ì„¤ì •
            document.getElementById('pageLoadDelay').value = formData.timing?.page_load_delay || 3;
            document.getElementById('elementWaitTime').value = formData.timing?.element_wait_time || 10;

            // ë©”ì¼ í…œí”Œë¦¿ (ê¸°ë³¸ê°’ ìš°ì„ )
            document.getElementById('subjectTemplate').value = formData.email_template?.subject_template || defaultEmailTemplates.subject;
            document.getElementById('bodyTemplate').value = formData.email_template?.body_template || defaultEmailTemplates.body;

            // í…ŒìŠ¤íŠ¸ ëª¨ë“œ
            document.getElementById('testStartRow').value = formData.excel_settings?.test_mode?.start_row || 2;
            document.getElementById('testEndRow').value = formData.excel_settings?.test_mode?.end_row || 5;
            document.getElementById('testModeEnabled').value = formData.excel_settings?.test_mode?.enabled ? 'true' : 'false';
        }
        
        // ì„œë²„ ë°ì´í„°ë¡œ í¼ ì±„ìš°ê¸° (ê¸°ì¡´ ë°©ì‹)
        function populateFormWithServerData() {
            // ë¡œê·¸ì¸ ì •ë³´
            document.getElementById('loginUrl').value = currentConfig.login?.url || '';
            document.getElementById('userId').value = currentConfig.login?.user_id || '';
            document.getElementById('password').value = currentConfig.login?.password || '';

            // íŒŒì¼ ê²½ë¡œ - í”Œë ˆì´ìŠ¤í™€ë”ë§Œ í‘œì‹œí•˜ë„ë¡ value ì„¤ì • ì œê±°
            // document.getElementById('cxExcel').value = currentConfig.file_paths?.cx_excel || '';
            // document.getElementById('claimListDir').value = currentConfig.file_paths?.claim_list_dir || '';
            // document.getElementById('resultsDir').value = currentConfig.file_paths?.results_dir || '';
            // document.getElementById('logsDir').value = currentConfig.file_paths?.logs_dir || '';

            // ì‹¤í–‰ ì„¤ì •
            document.getElementById('pageLoadDelay').value = currentConfig.timing?.page_load_delay || 3;
            document.getElementById('elementWaitTime').value = currentConfig.timing?.element_wait_time || 10;

            // ë©”ì¼ í…œí”Œë¦¿ (ê¸°ë³¸ê°’ ìš°ì„ )
            document.getElementById('subjectTemplate').value = currentConfig.email_template?.subject_template || defaultEmailTemplates.subject;
            document.getElementById('bodyTemplate').value = currentConfig.email_template?.body_template || defaultEmailTemplates.body;

            // í…ŒìŠ¤íŠ¸ ëª¨ë“œ
            document.getElementById('testStartRow').value = currentConfig.excel_settings?.test_mode?.start_row || 2;
            document.getElementById('testEndRow').value = currentConfig.excel_settings?.test_mode?.end_row || 5;
            document.getElementById('testModeEnabled').value = currentConfig.excel_settings?.test_mode?.enabled ? 'true' : 'false';
        }

        // ì„¤ì • ì €ì¥
        async function saveConfig() {
            try {
                const configData = {
                    login: {
                        url: document.getElementById('loginUrl').value,
                        user_id: document.getElementById('userId').value,
                        password: document.getElementById('password').value
                    },
                    file_paths: {
                        cx_excel: document.getElementById('cxExcel').value,
                        claim_list_dir: document.getElementById('claimListDir').value,
                        results_dir: document.getElementById('resultsDir').value,
                        logs_dir: document.getElementById('logsDir').value
                    },
                    timing: {
                        page_load_delay: parseInt(document.getElementById('pageLoadDelay').value) || 3,
                        element_wait_time: parseInt(document.getElementById('elementWaitTime').value) || 10
                    }
                };

                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(configData)
                });

                const result = await response.json();
                
                if (result.success) {
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ë„ ì €ì¥
                    localStorage.setItem('cx_claim_form_data', JSON.stringify(configData));
                    
                    showSuccess('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    currentConfig = { ...currentConfig, ...configData };
                } else {
                    showError('ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                showError('ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë©”ì¼ í…œí”Œë¦¿ ì €ì¥
        async function saveEmailTemplates() {
            try {
                const templateData = {
                    subject_template: document.getElementById('subjectTemplate').value,
                    body_template: document.getElementById('bodyTemplate').value
                };

                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email_template: templateData })
                });

                const result = await response.json();
                
                if (result.success) {
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ë„ ì €ì¥
                    const savedData = JSON.parse(localStorage.getItem('cx_claim_form_data') || '{}');
                    savedData.email_template = templateData;
                    localStorage.setItem('cx_claim_form_data', JSON.stringify(savedData));
                    
                    showSuccess('ë©”ì¼ í…œí”Œë¦¿ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    showError('ë©”ì¼ í…œí”Œë¦¿ ì €ì¥ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                showError('ë©”ì¼ í…œí”Œë¦¿ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // í…ŒìŠ¤íŠ¸ ì„¤ì • ì €ì¥
        async function saveTestConfig() {
            try {
                const testData = {
                    excel_settings: {
                        test_mode: {
                            enabled: document.getElementById('testModeEnabled').value === 'true',
                            start_row: parseInt(document.getElementById('testStartRow').value) || 2,
                            end_row: parseInt(document.getElementById('testEndRow').value) || 5
                        }
                    }
                };

                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                const result = await response.json();
                
                if (result.success) {
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ë„ ì €ì¥
                    const savedData = JSON.parse(localStorage.getItem('cx_claim_form_data') || '{}');
                    savedData.excel_settings = testData.excel_settings;
                    localStorage.setItem('cx_claim_form_data', JSON.stringify(savedData));
                    
                    showSuccess('í…ŒìŠ¤íŠ¸ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    showError('í…ŒìŠ¤íŠ¸ ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                showError('í…ŒìŠ¤íŠ¸ ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // í”„ë¡œì íŠ¸ ì‹œì‘
        async function startProject() {
            // í™•ì¸ ì•ŒëŸ¿
            const confirmed = confirm('í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
            if (!confirmed) {
                return; // ì·¨ì†Œ ì‹œ í•¨ìˆ˜ ì¢…ë£Œ
            }
            
            try {
                const response = await fetch('/api/start', {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (result.success) {
                    showSuccess('í”„ë¡œì íŠ¸ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                } else {
                    showError('í”„ë¡œì íŠ¸ ì‹œì‘ ì‹¤íŒ¨: ' + result.message);
                }
            } catch (error) {
                showError('í”„ë¡œì íŠ¸ ì‹œì‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // í”„ë¡œì íŠ¸ ì¤‘ë‹¨
        async function stopProject() {
            try {
                const response = await fetch('/api/stop', {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (result.success) {
                    showSuccess('í”„ë¡œì íŠ¸ê°€ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                } else {
                    showError('í”„ë¡œì íŠ¸ ì¤‘ë‹¨ ì‹¤íŒ¨: ' + result.message);
                }
            } catch (error) {
                showError('í”„ë¡œì íŠ¸ ì¤‘ë‹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ìƒíƒœ ë¡œë“œ
        async function loadStatus() {
            try {
                const response = await fetch('/api/status');
                const result = await response.json();
                
                if (result.success) {
                    updateStatusDisplay(result);
                }
            } catch (error) {
                console.error('ìƒíƒœ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStatusDisplay(status) {
            const indicator = document.getElementById('statusIndicator');
            const text = document.getElementById('statusText');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');

            // ìƒíƒœì— ë”°ë¥¸ í‘œì‹œ ì—…ë°ì´íŠ¸
            indicator.className = 'status-indicator';
            switch (status.status) {
                case 'idle':
                    indicator.classList.add('status-waiting');
                    text.textContent = 'ëŒ€ê¸° ì¤‘';
                    progressContainer.style.display = 'none';
                    break;
                case 'running':
                    indicator.classList.add('status-running');
                    text.textContent = 'ì‹¤í–‰ ì¤‘';
                    progressContainer.style.display = 'block';
                    progressFill.style.width = status.progress + '%';
                    progressText.textContent = status.progress + '%';
                    break;
                case 'completed':
                    indicator.classList.add('status-completed');
                    text.textContent = 'ì™„ë£Œ';
                    progressContainer.style.display = 'block';
                    progressFill.style.width = '100%';
                    progressText.textContent = '100%';
                    break;
                case 'error':
                    indicator.classList.add('status-failed');
                    text.textContent = 'ì˜¤ë¥˜';
                    progressContainer.style.display = 'block';
                    break;
            }

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('startBtn').disabled = status.status === 'running';
            document.getElementById('stopBtn').disabled = status.status !== 'running';
        }

        // ìƒíƒœ í´ë§ ì‹œì‘
        function startStatusPolling() {
            statusInterval = setInterval(loadStatus, 2000);
        }

        // ìƒíƒœ í´ë§ ì¤‘ì§€
        function stopStatusPolling() {
            if (statusInterval) {
                clearInterval(statusInterval);
                statusInterval = null;
            }
        }

        // ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ
        async function loadDataPreview() {
            try {
                const response = await fetch('/api/excel-data');
                const result = await response.json();
                
                if (result.success) {
                    displayDataPreview(result.data);
                } else {
                    showError('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                showError('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë°ì´í„° ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function displayDataPreview(data) {
            const statsContainer = document.getElementById('previewStats');
            const tableContainer = document.getElementById('previewTable');

            // í†µê³„ ì¹´ë“œ ìƒì„±
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${data.total_count || 0}</div>
                    <div class="stat-label">ì´ ë°ì´í„° ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${data.today_count || 0}</div>
                    <div class="stat-label">ì˜¤ëŠ˜ ì²˜ë¦¬ ëŒ€ìƒ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Object.keys(data.category_stats || {}).length}</div>
                    <div class="stat-label">ìš”ì²­ ë¶„ë¥˜ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Object.keys(data.manager_stats || {}).length}</div>
                    <div class="stat-label">ë‹´ë‹¹ì ìˆ˜</div>
                </div>
            `;

            // ë°ì´í„° í…Œì´ë¸” ìƒì„±
            if (data.sample_data && data.sample_data.length > 0) {
                let tableHTML = '<table class="data-table"><thead><tr>';
                tableHTML += '<th>NO</th><th>ì£¼ë¬¸ë²ˆí˜¸</th><th>ê³ ê°ëª…</th><th>ìš”ì²­ë¶„ë¥˜</th><th>ìš”ì²­ì‚¬ìœ </th><th>ë‹´ë‹¹ì</th><th>ìš”ì²­ë‚ ì§œ</th>';
                tableHTML += '</tr></thead><tbody>';

                data.sample_data.forEach(row => {
                    tableHTML += '<tr>';
                    tableHTML += `<td>${row.no || ''}</td>`;
                    tableHTML += `<td>${row.order_number || ''}</td>`;
                    tableHTML += `<td>${row.customer_name || ''}</td>`;
                    tableHTML += `<td>${row.request_category || ''}</td>`;
                    tableHTML += `<td>${row.request_reason || ''}</td>`;
                    tableHTML += `<td>${row.manager || ''}</td>`;
                    tableHTML += `<td>${row.request_date || ''}</td>`;
                    tableHTML += '</tr>';
                });

                tableHTML += '</tbody></table>';
                tableContainer.innerHTML = tableHTML;
            } else {
                tableContainer.innerHTML = '<p>í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // ë©”ì¼ í…œí”Œë¦¿ ê¸°ë³¸ê°’
        const defaultEmailTemplates = {
            subject: "[{ìš”ì²­ë¶„ë¥˜}] {ì²´í¬ì¸} ~ {ì²´í¬ì•„ì›ƒ}_{ìˆ™ì†Œ}_{íˆ¬ìˆ™ì}, CFM NO. {Book NO} {ìš”ì²­ë‚ ì§œ} BY {ë‹´ë‹¹ì}",
            body: "ì•ˆë…•í•˜ì„¸ìš”. ì˜¬ë§ˆì´íˆ¬ì–´ CXíŒ€ì…ë‹ˆë‹¤.\në°”ì˜ì‹œê² ì§€ë§Œ í•˜ê¸° ë‚´ìš© í™•ì¸ í›„ ë©”ì¼ íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤. ğŸ™\n\n\n- ì•„ ë˜ -\n\n1. ì˜ˆì•½ì •ë³´ \n1) íˆ¬ìˆ™ê° ì´ë¦„/ì—°ë½ì²˜ : {íˆ¬ìˆ™ìëª…} / {íˆ¬ìˆ™ì ì—°ë½ì²˜} \n2) ì²´í¬ì¸~ ì•„ì›ƒë‚ ì§œ / ë°•ìˆ˜ : {ì²´í¬ì¸} ~ {ì²´í¬ì•„ì›ƒ} / {ë°•ìˆ˜}\n3) ê°ì‹¤ìˆ˜ : {ê°ì‹¤ìˆ˜}\n4) íƒ€ì…ëª… : {ê°ì‹¤ëª…}\n5) ìƒí’ˆëª… : {ìƒí’ˆëª…}\n6) ì»¨íŒë²ˆí˜¸ : {Book NO}\n\n2. ìš”ì²­ì‚¬í•­ \n1) ìš”ì²­ì‚¬ìœ  : {ìš”ì²­ì‚¬ìœ }\n2) ìš”ì²­ë‚´ìš© : {ìš”ì²­ì‚¬í•­}\n\n\nê°ì‚¬í•©ë‹ˆë‹¤.ğŸ˜Š\n\nì˜¬ë§ˆì´íˆ¬ì–´ CXíŒ€ ë“œë¦¼."
        };

        // ë©”ì¼ í…œí”Œë¦¿ ì´ˆê¸°í™”
        function resetEmailTemplates() {
            document.getElementById('subjectTemplate').value = defaultEmailTemplates.subject;
            document.getElementById('bodyTemplate').value = defaultEmailTemplates.body;
            showSuccess('ë©”ì¼ í…œí”Œë¦¿ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ë©”ì¼ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°
        async function previewEmailTemplate() {
            try {
                const templateData = {
                    subject_template: document.getElementById('subjectTemplate').value,
                    body_template: document.getElementById('bodyTemplate').value
                };

                const response = await fetch('/api/email-preview', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(templateData)
                });

                const result = await response.json();
                console.log('ë©”ì¼ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ì‘ë‹µ:', result);
                
                const errorElement = document.getElementById('emailError');
                const subjectElement = document.getElementById('emailSubject');
                const bodyElement = document.getElementById('emailBody');
                const previewElement = document.getElementById('emailPreview');
                
                if (result.success) {
                    const preview = result.preview;
                    console.log('Preview ë°ì´í„°:', preview);
                    
                    // ì¤‘ì²©ëœ êµ¬ì¡° ì²˜ë¦¬
                    const actualPreview = preview.preview || preview;
                    console.log('Actual Preview:', actualPreview);
                    console.log('Subject:', actualPreview.subject);
                    console.log('Body:', actualPreview.body);
                    
                    if (subjectElement && bodyElement && previewElement) {
                        // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
                        if (errorElement) errorElement.style.display = 'none';
                        
                        subjectElement.textContent = actualPreview.subject;
                        bodyElement.textContent = actualPreview.body;
                        previewElement.style.display = 'block';
                        console.log('ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ ì™„ë£Œ');
                    } else {
                        console.error('DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    }
                } else {
                    // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                    if (errorElement && previewElement) {
                        errorElement.textContent = result.error || 'ë¯¸ë¦¬ë³´ê¸° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        errorElement.style.display = 'block';
                        previewElement.style.display = 'block';
                    } else {
                        showError('ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì‹¤íŒ¨: ' + result.error);
                    }
                }
            } catch (error) {
                showError('ë¯¸ë¦¬ë³´ê¸° ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }


        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(message) {
            alert('âœ… ' + message);
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            alert('âŒ ' + message);
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', function() {
            stopStatusPolling();
        });
    </script>
</body>
</html>
